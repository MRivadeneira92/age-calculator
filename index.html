<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- displays site properly based on user's device -->

  <link rel="icon" type="image/png" sizes="32x32" href="./assets/images/favicon-32x32.png">
  
  <title>Frontend Mentor | Age calculator app</title>
  <link rel="stylesheet" href="./style.css">
  <!-- Feel free to remove these styles or customise in your own stylesheet ðŸ‘ -->
</head>
<body>

  <div class="container">
    <div class="input-container">
      <div class="num-container" id="container-day">
        <p>DAY</p>
        <input type="number" placeholder="DD" id="input-day">
        <p class="error-message" id="error-day">Must be a valid day</p>
      </div>
      <div class="num-container" id="container-month">
        <p>MONTH</p>
        <input type="number" placeholder="MM" id="input-month">
        <p class="error-message" id="error-month">Must be a valid month</p>
      </div>
      <div class="num-container" id="container-year">
        <p>YEAR</p>
        <input type="number" placeholder="YYYY" id="input-year">
        <p class="error-message" id="error-year">Must be in the past</p>
      </div>
    </div>
    <div class="line-button">
      <hr>
      <button type="button" id="button-calc"><img src="./assets/images/icon-arrow.svg" alt="button"></button>
    </div>
    <div class="result">
      <div class="result-num">
        <div id="result-years" class="result-digit">
          <p id="result-year-1" class="result-pos">-</p>
          <p id="result-year-0" class="result-pos">-</p>
        </div>
        <p>years</p>
      </div>
      <div id="ani-year-container" class="animation-load-year">
        <p id="an-load-year-1">-</p>
        <div id="an-load-year-0"></div>
      </div>
      <div class="result-num">
        <p id="result-month" class="result-digit">--</p>
        <p>months</p>
      </div>
      <div class="result-num">
        <p id="result-days" class="result-digit">--</p>
        <p>days</p>
      </div>
    </div>
  </div>
  <div class="attribution">
    Challenge by <a href="https://www.frontendmentor.io?ref=challenge" target="_blank">Frontend Mentor</a>. 
    Coded by <a href="#">Max Rivadeneira</a>.
  </div>
</body>
<script>  
  let inputDay = document.getElementById("input-day");
  let inputMonth = document.getElementById("input-month");
  let inputYear = document.getElementById("input-year");
  let btnCalc = document.getElementById("button-calc");
  let today = new Date(); 
  let finalDay = 0;
  let finalMonth = 0;
  let finalYear = 0;
  let inputError = false; 

  btnCalc.addEventListener("click", function(e) {
    inputDay = Number(document.getElementById("input-day").value);
    inputMonth = Number(document.getElementById("input-month").value);
    inputYear = Number(document.getElementById("input-year").value);
    // Error checking 

    if (inputError = true) {
      document.getElementById("container-day").classList.remove("error");
      document.getElementById("container-year").classList.remove("error");
      document.getElementById("container-month").classList.remove("error");
      document.getElementById("input-day").classList.remove("error-input");
      document.getElementById("input-month").classList.remove("error-input");
      document.getElementById("input-year").classList.remove("error-input");
      document.getElementById("error-day").style.display = "none";
      document.getElementById("error-month").style.display = "none";
      document.getElementById("error-year").style.display = "none";
      inputError = false;
    }
    if (inputDay == "") {
      errorEmply("day");
      errorShow("day");
      inputError = true;
    }
    if (inputMonth == "") {
      errorEmply("month");
      errorShow("month");
      inputError = true;
    }
    if (inputYear == "") {
      errorEmply("year");
      errorShow("year");
      inputError = true;
    }

    if (inputDay >= 32) {
      document.getElementById("error-day").innerHTML = "Must be a valid day";
      document.getElementById("input-day").classList.add("error-input");
      errorShow("day");
      inputError = true;
    }

    dayCalc(inputDay, inputMonth);

    if (inputMonth >= 13 || inputMonth <= 0 && inputMonth != "") {
      document.getElementById("error-month").innerHTML = "Must be a valid month";
      document.getElementById("input-month").classList.add("error-input");
      errorShow("month");
      inputError = true;
    }
    
    if (inputYear > 2023 ) {
      document.getElementById("error-year").innerHTML = "Must be in the past";
      errorShow("year");
      inputError = true;
    }

    if (inputError == true) {
      document.getElementById("container-day").classList.add("error");
      document.getElementById("container-year").classList.add("error");
      document.getElementById("container-month").classList.add("error");
      document.getElementById("input-day").classList.add("error-input");
      document.getElementById("input-month").classList.add("error-input");
      document.getElementById("input-year").classList.add("error-input");
      return true; 
    }
    inputError = false;

    // Calculate date
    let removeYear = false;
    let removeMonth = false;
    let todayMonth = today.getMonth() + 1;
    if (inputMonth <= todayMonth && (inputDay > today.getDate())) {
      removeYear = true;
    }

    if (todayMonth == inputMonth && today.getDate() < inputDay) {
      inputMonth = inputMonth + 1;
    }

    if ((todayMonth - inputMonth) < 0 ) {
      inputMonth = inputMonth - 12;
    }
    
    if (removeYear == true) {
      inputYear = inputYear + 1;
    }

    //document.getElementById("result-years").innerHTML = today.getFullYear() - inputYear; // 
    document.getElementById("result-month").innerHTML = todayMonth - inputMonth;
    document.getElementById("result-days").innerHTML = today.getDate() - inputDay;
    if (today.getDate() - inputDay < 0) {
      document.getElementById("result-days").innerHTML = 31 + (today.getDate() - inputDay);    
    }
    let resultYear = today.getFullYear() - inputYear;
    let resultMonth = todayMonth - inputMonth;
    let resultDay = today.getDate() - inputDay;
    let yearGroup = separateDigits(resultYear);
    let monthGroup = separateDigits(resultMonth);
    let dayMonth = separateDigits(resultDay);
    animateDigit(yearGroup, "year");
  });

  // number separation for animation 
  let resultYear = today.getFullYear() - inputYear;
  let resultMonth = todayMonth - inputMonth;
  let resultDay = today.getDate() - inputDay;
  let yearGroup = separateDigits(resultYear);
  let monthGroup = separateDigits(resultMonth);
  let dayMonth = separateDigits(resultDay);


  function animateDigit(value, position) {
    var counter = 0; 
    let numberCounter = 0;
    let objectCounter = Object.keys(value).length;
    let targetValue = value[numberCounter];
    var i = setInterval(function() {
      if (counter == targetValue) {
        clearInterval(i)
        document.getElementById("result-"+ position + "-" + numberCounter).innerHTML = counter;
        document.getElementById("result-"+ position + "-" + numberCounter).classList.add("ani-up-final");
        numberCounter++;
      }
      else {
        let tagId = "ani-number"+ counter;
        let newTag =  '<p id="' + tagId + '" class="ani-up">' + counter + '</p>';
        document.getElementById("an-load-" + position + "-0").insertAdjacentHTML("afterbegin" , newTag);
        counter++;
        setTimeout(function() {
        document.querySelector(".ani-up").remove();
        }, 450)
      }
    }, 460) 
  }

  function deleteNumber(pos) {
      document.getElementById("ani-number"+pos).remove();
      }

  // Functions
  function errorShow(date) {
    document.getElementById("error-" + date).style.display = "block";
  }
  function errorEmply(date) {
    document.getElementById("error-"+ date).innerHTML = "This field is required";
  }

  function dayCalc(day,month) {
    if ((month == 4 || month == 6  || month == 9 || month == 11) && day >= 31) {
      document.getElementById("container-day").classList.add("error");
      document.getElementById("input-day").classList.add("error-input");
      document.getElementById("error-day").innerHTML = "Must be a valid day";
      errorShow("day");
      inputError = true;
    }
    if (month == 2 && day >= 29) {
      document.getElementById("container-day").classList.add("error");
      document.getElementById("input-day").classList.add("error-input");
      document.getElementById("error-day").innerHTML = "Must be a valid day";
      errorShow("day");
      inputError = true;
    }
  }

  function separateDigits(numbers) {
    let digits = numbers.toString().split("");
    let realDigits = digits.map(Number);
    return realDigits;
  }

</script>
</html>